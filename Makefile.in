install: build-compose-file ${INSTALL_TARGET}

install-docker:
	docker-compose build
	docker-compose up -d
	docker-compose run --rm -w /var/www/html/lidsys-web php-fpm composer install
	docker-compose run --rm -w /var/www/html/lidsys-web php-fpm npm install

install-pier: install-dev-db install-dev

install-dev: install-dev-config install-docker

install-dev-db:
	rsync -aP ${BACKUP_LOCATION} ./docker/mariadb/initdb.d/

install-dev-config:
	cp config/autoload/database.dev.php config/autoload/database.local.php
	cp config/autoload/debug.dev.php config/autoload/debug.local.php

build-compose-file:
	cp -a docker/docker-compose.*.yml .
	docker-compose $(COMPOSE_FILES) config >docker-compose.yml
	rm docker-compose.*.yml
