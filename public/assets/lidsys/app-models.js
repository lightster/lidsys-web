// Generated by CoffeeScript 1.6.3
(function() {
  var ActiveService, FootballScheduleService, FootballTeamService, User,
    __hasProp = {}.hasOwnProperty;

  window.ActiveService = ActiveService = (function() {
    function ActiveService() {
      this.user = null;
    }

    ActiveService.prototype.setUser = function(user) {
      this.user = user;
    };

    ActiveService.prototype.getUser = function() {
      return this.user;
    };

    ActiveService.prototype.isLoggedIn = function() {
      if (this.user.userId) {
        return true;
      } else {
        return false;
      }
    };

    return ActiveService;

  })();

  window.User = User = (function() {
    function User() {
      this.userId = null;
      this.permissions = {};
    }

    User.prototype.isAuthorized = function(permission) {
      if ((this.permissions[permission] != null) && this.permissions[permission]) {
        return true;
      } else {
        return false;
      }
    };

    User.prototype.setFromApi = function(options) {
      this.userId = options.user_id;
      this.username = options.username;
      return this;
    };

    return User;

  })();

  window.FootballScheduleService = FootballScheduleService = (function() {
    function FootballScheduleService($http, $q) {
      this.$http = $http;
      this.$q = $q;
      this.seasons = null;
      this.weeks = {};
      this.games = {};
      this.selectedSeason = null;
      this.selectedWeek = null;
    }

    FootballScheduleService.prototype.setSelectedWeek = function(selectedYear, selectedWeekNumber) {
      return this.load(selectedYear, selectedWeekNumber);
    };

    FootballScheduleService.prototype.getSelectedSeason = function() {
      return this.selectedSeason;
    };

    FootballScheduleService.prototype.getSelectedWeek = function() {
      return this.selectedWeek;
    };

    FootballScheduleService.prototype.load = function(requestedYear, requestedWeek) {
      var week, year,
        _this = this;
      year = requestedYear;
      week = requestedWeek;
      return this.$q.when(this.loadSeasons()).then(function(response) {
        var a_year, seasons;
        seasons = _this.getSeasons();
        if (seasons[year] == null) {
          for (a_year in seasons) {
            if (!__hasProp.call(seasons, a_year)) continue;
            year = a_year;
          }
        }
        return _this.$q.when(_this.loadWeeks(year));
      }).then(function(response) {
        var a_week, today, week_num, weeks;
        today = moment().format('YYYY-MM-DD');
        weeks = _this.getWeeks(year);
        if (weeks[week] == null) {
          week = 0;
          for (week_num in weeks) {
            if (!__hasProp.call(weeks, week_num)) continue;
            a_week = weeks[week_num];
            if (a_week.start_date < today || !week) {
              week = week_num;
            }
          }
        }
        if (requestedYear !== year || requestedWeek !== week) {
          return _this.$q.reject({
            year: year,
            week: week
          });
        } else {
          _this.selectedSeason = _this.getSeason(year);
          _this.selectedWeek = _this.getWeek(year, week);
          return _this.$q.when(_this.loadGames(year, week));
        }
      });
    };

    FootballScheduleService.prototype.loadSeasons = function() {
      var _this = this;
      if (this.seasons != null) {
        return this.seasons;
      }
      return this.$http.get("/api/v1.0/football/seasons").success(function(response) {
        return _this.seasons = response.seasons;
      });
    };

    FootballScheduleService.prototype.loadWeeks = function(year) {
      var _this = this;
      if (this.weeks[year] != null) {
        return this.weeks[year];
      }
      return this.$http.get("/api/v1.0/football/weeks/" + year).success(function(response) {
        return _this.weeks[year] = response.weeks;
      });
    };

    FootballScheduleService.prototype.loadGames = function(year, week) {
      var _this = this;
      if ((this.games[year] != null) && (this.games[year][week] != null)) {
        return this.games[year][week];
      }
      return this.$http.get("/api/v1.0/football/schedule/" + year + "/" + week).success(function(response) {
        _this.games[year] = {};
        return _this.games[year][week] = response.games;
      });
    };

    FootballScheduleService.prototype.getSeason = function(year) {
      return this.getSeasons()[year];
    };

    FootballScheduleService.prototype.getSeasons = function() {
      if (this.seasons == null) {
        throw "Seasons not yet loaded using 'loadSeasons'";
      }
      return this.seasons;
    };

    FootballScheduleService.prototype.getWeek = function(year, week_num) {
      return this.getWeeks(year)[week_num];
    };

    FootballScheduleService.prototype.getWeeks = function(year) {
      if (this.weeks[year] == null) {
        throw "Weeks not yet loaded using 'loadWeeks' for year" + year;
      }
      return this.weeks[year];
    };

    FootballScheduleService.prototype.getWeeksArray = function(year) {
      var week, week_num, _ref, _results;
      if (this.weeks[year] == null) {
        throw "Weeks not yet loaded using 'loadWeeks' for year" + year;
      }
      _ref = this.weeks[year];
      _results = [];
      for (week_num in _ref) {
        if (!__hasProp.call(_ref, week_num)) continue;
        week = _ref[week_num];
        _results.push(week);
      }
      return _results;
    };

    FootballScheduleService.prototype.getGames = function(year, week_num) {
      if (year == null) {
        year = this.selectedSeason.year;
        week_num = null;
      }
      if (week_num == null) {
        week_num = this.selectedWeek.week_number;
      }
      if ((this.games[year] == null) || (this.games[year][week_num] == null)) {
        throw "Games not yet loaded using 'loadGames' for year " + year + " week " + week_num;
      }
      return this.games[year][week_num];
    };

    return FootballScheduleService;

  })();

  window.FootballTeamService = FootballTeamService = (function() {
    function FootballTeamService($http, $q) {
      this.$http = $http;
      this.$q = $q;
      this.teams = null;
    }

    FootballTeamService.prototype.load = function() {
      return this.$q.when(this.loadTeams());
    };

    FootballTeamService.prototype.loadTeams = function() {
      var _this = this;
      if (this.teams != null) {
        return this.teams;
      }
      return this.$http.get("/api/v1.0/football/teams").success(function(response) {
        return _this.teams = response.teams;
      });
    };

    FootballTeamService.prototype.getTeams = function() {
      if (this.teams == null) {
        throw "Teams not yet loaded using 'loadTeams'";
      }
      return this.teams;
    };

    return FootballTeamService;

  })();

  window.FootballTeamStandingService = FootballTeamService = (function() {
    function FootballTeamService($http, $q) {
      this.$http = $http;
      this.$q = $q;
      this.teamStandings = {};
    }

    FootballTeamService.prototype.load = function(requestedYear, requestedWeek) {
      return this.$q.when(this.loadTeamStandings(requestedYear, requestedWeek));
    };

    FootballTeamService.prototype.loadTeamStandings = function(year, week) {
      var _this = this;
      if ((this.teamStandings[year] != null) && (this.teamStandings[year][week] != null)) {
        return this.teamStandings[year][week];
      }
      return this.$http.get("/api/v1.0/football/team-standings/" + year + "/" + week).success(function(response) {
        _this.teamStandings[year] = {};
        return _this.teamStandings[year][week] = response.team_standings;
      });
    };

    FootballTeamService.prototype.getTeamStandings = function(year, week_num) {
      if ((this.teamStandings[year] == null) || (this.teamStandings[year][week_num] == null)) {
        throw "Team standings not yet loaded using 'loadTeamStandings' for year " + year + " week " + week_num;
      }
      return this.teamStandings[year][week_num];
    };

    return FootballTeamService;

  })();

}).call(this);
