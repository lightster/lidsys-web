// Generated by CoffeeScript 1.6.3
(function() {
  var ActiveService, FootballScheduleService, User,
    __hasProp = {}.hasOwnProperty;

  window.ActiveService = ActiveService = (function() {
    function ActiveService() {
      this.user = null;
    }

    ActiveService.prototype.setUser = function(user) {
      this.user = user;
    };

    ActiveService.prototype.getUser = function() {
      return this.user;
    };

    ActiveService.prototype.isLoggedIn = function() {
      if (this.user.userId) {
        return true;
      } else {
        return false;
      }
    };

    return ActiveService;

  })();

  window.User = User = (function() {
    function User() {
      this.userId = null;
      this.permissions = {};
    }

    User.prototype.isAuthorized = function(permission) {
      if ((this.permissions[permission] != null) && this.permissions[permission]) {
        return true;
      } else {
        return false;
      }
    };

    User.prototype.setFromApi = function(options) {
      this.userId = options.user_id;
      this.username = options.username;
      return this;
    };

    return User;

  })();

  window.FootballScheduleService = FootballScheduleService = (function() {
    function FootballScheduleService($http, $q) {
      this.$http = $http;
      this.$q = $q;
      this.seasons = null;
      this.weeks = {};
      this.games = {};
    }

    FootballScheduleService.prototype.load = function(current_route) {
      var week, year,
        _this = this;
      year = current_route.params.year;
      week = current_route.params.week;
      return this.$q.when(this.loadSeasons()).then(function(response) {
        var a_year, seasons;
        seasons = _this.getSeasons();
        if (seasons[year] == null) {
          for (a_year in seasons) {
            if (!__hasProp.call(seasons, a_year)) continue;
            year = a_year;
          }
          current_route.params.year = year;
        }
        return _this.$q.when(_this.loadWeeks(year));
      }).then(function(response) {
        var a_week, today, week_num, weeks;
        today = moment().format('YYYY-MM-DD');
        weeks = _this.getWeeks(year);
        if (weeks[week] == null) {
          week = 0;
          for (week_num in weeks) {
            if (!__hasProp.call(weeks, week_num)) continue;
            a_week = weeks[week_num];
            if (start_date > today || !week) {
              week = week_num;
            }
          }
          current_route.params.week = week;
        }
        return _this.$q.when(_this.loadGames(year, week));
      });
    };

    FootballScheduleService.prototype.loadSeasons = function() {
      var _this = this;
      if (this.seasons != null) {
        return this.seasons;
      }
      return this.$http.get("/api/v1.0/football/seasons").success(function(response) {
        return _this.seasons = response.seasons;
      });
    };

    FootballScheduleService.prototype.loadWeeks = function(year) {
      var _this = this;
      if (this.weeks[year] != null) {
        return this.weeks[year];
      }
      return this.$http.get("/api/v1.0/football/weeks/" + year).success(function(response) {
        return _this.weeks[year] = response.weeks;
      });
    };

    FootballScheduleService.prototype.loadGames = function(year, week) {
      var _this = this;
      if ((this.games[year] != null) && (this.games[year][week] != null)) {
        return this.games[year][week];
      }
      return this.$http.get("/api/v1.0/football/schedule/" + year + "/" + week).success(function(response) {
        _this.games[year] = {};
        _this.games[year][week] = response.games;
        return console.log(_this.games);
      });
    };

    FootballScheduleService.prototype.getSeasons = function() {
      if (this.seasons == null) {
        throw "Seasons not yet loaded using 'loadSeasons'";
      }
      return this.seasons;
    };

    FootballScheduleService.prototype.getWeeks = function(year) {
      if (this.weeks[year] == null) {
        throw "Weeks not yet loaded using 'loadWeeks' for year" + year;
      }
      return this.weeks[year];
    };

    FootballScheduleService.prototype.getGames = function(year, week) {
      if ((this.games[year] == null) || (this.games[year][week] == null)) {
        throw "Games not yet loaded using 'loadGames' for year " + year + " week " + week;
      }
      return this.games[year][week];
    };

    return FootballScheduleService;

  })();

}).call(this);
